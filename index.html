<!DOCTYPE html>
<html lang="en">

<head><!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-77V3TP2B5T"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        // Security: Exclude URL hash from analytics to prevent leaking spreadsheet data
        gtag('config', 'G-77V3TP2B5T', {
            'page_location': window.location.origin + window.location.pathname,
            'page_path': window.location.pathname
        });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--
        Security Note: Content Security Policy
        - 'unsafe-inline' in style-src is required for user-controlled dynamic cell styling (colors, alignment, font-size).
        - Removing 'unsafe-inline' would require refactoring all style.setProperty() and inline style assignments.
        - XSS mitigations in script.js:
          1. sanitizeHTML() uses DOMParser-based whitelist filtering (ALLOWED_TAGS, ALLOWED_SPAN_STYLES)
          2. isContentSafe() provides defense-in-depth pattern detection for dangerous content
          3. isValidCSSColor() validates color inputs to prevent CSS injection
          4. safeJSONParse() prevents prototype pollution from URL state
        - Note: script-src does NOT include 'unsafe-inline' or 'unsafe-eval', blocking inline script injection
    -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com data:; img-src 'self' data:; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com;">
    <title>Spreadsheet</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">

</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fa-solid fa-table-cells"></i> Spreadsheet</h1>
            <div class="toolbar">
                <div class="format-buttons">
                    <button id="format-bold" type="button" class="format-btn" title="Bold (Ctrl+B)"><i
                            class="fa-solid fa-bold"></i></button>
                    <button id="format-italic" type="button" class="format-btn" title="Italic (Ctrl+I)"><i
                            class="fa-solid fa-italic"></i></button>
                    <button id="format-underline" type="button" class="format-btn" title="Underline (Ctrl+U)"><i
                            class="fa-solid fa-underline"></i></button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="format-buttons">
                    <button id="align-left" type="button" class="format-btn" title="Align left"><i
                            class="fa-solid fa-align-left"></i></button>
                    <button id="align-center" type="button" class="format-btn" title="Align center"><i
                            class="fa-solid fa-align-center"></i></button>
                    <button id="align-right" type="button" class="format-btn" title="Align right"><i
                            class="fa-solid fa-align-right"></i></button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="size-control" id="font-size-list" title="Font size" role="group" aria-label="Font size">
                    <span class="size-control-label" aria-hidden="true"><i class="fa-solid fa-text-height"></i></span>
                    <button type="button" class="size-option" data-size="" aria-label="Font size auto">Auto</button>
                    <button type="button" class="size-option" data-size="10" aria-label="Font size 10">10</button>
                    <button type="button" class="size-option" data-size="12" aria-label="Font size 12">12</button>
                    <button type="button" class="size-option" data-size="14" aria-label="Font size 14">14</button>
                    <button type="button" class="size-option" data-size="16" aria-label="Font size 16">16</button>
                    <button type="button" class="size-option" data-size="18" aria-label="Font size 18">18</button>
                    <button type="button" class="size-option" data-size="24" aria-label="Font size 24">24</button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="color-control" title="Cell background color">
                    <i class="fa-solid fa-fill-drip"></i>
                    <input id="cell-bg-color" type="color" value="#ffffff" aria-label="Cell background color">
                </div>
                <div class="color-control" title="Text color">
                    <i class="fa-solid fa-font"></i>
                    <input id="cell-text-color" type="color" value="#000000" aria-label="Cell text color">
                </div>
                <div class="toolbar-divider"></div>
                <button id="add-row" type="button"><i class="fa-solid fa-plus"></i> Row</button>
                <button id="add-col" type="button"><i class="fa-solid fa-plus"></i> Column</button>
                <button id="clear-spreadsheet" type="button" title="Clear all data and reset spreadsheet">
                    <i class="fa-solid fa-eraser"></i> Clear
                </button>
                <span id="grid-size" class="grid-size"><i class="fa-solid fa-grip"></i> 10 Ã— 10</span>
                <button id="theme-toggle" type="button" class="theme-toggle" title="Toggle dark/light mode">
                    <i class="fa-solid fa-sun icon-light"></i>
                    <i class="fa-solid fa-moon icon-dark"></i>
                </button>
                <button id="copy-url" type="button" class="copy-btn" title="Copy URL to clipboard">
                    <i class="fa-solid fa-copy"></i>
                </button>
                <button id="import-csv" type="button" class="copy-btn" title="Import CSV">
                    <i class="fa-solid fa-file-import"></i>
                </button>
                <input id="import-csv-file" type="file" accept=".csv,text/csv" hidden>
                <button id="export-csv" type="button" class="copy-btn" title="Download CSV">
                    <i class="fa-solid fa-file-csv"></i>
                </button>
                <button id="lock-btn" type="button" class="copy-btn lock-btn" title="Password Protection">
                    <i class="fa-solid fa-lock-open"></i>
                </button>
                <a href="https://github.com/supunlakmal/spreadsheet" target="_blank" rel="noopener noreferrer"
                    class="github-link" title="View on GitHub">
                    <i class="fa-brands fa-github"></i>
                </a>
            </div>
        </div>
        <div class="grid-wrapper">
            <div id="spreadsheet" class="spreadsheet"></div>
        </div>
        <div class="hint"><i class="fa-solid fa-link"></i> Data is saved in the URL - share the link to share your
            spreadsheet</div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h3 id="modal-title">Set Password</h3>
            <p id="modal-description">Enter a password to encrypt this spreadsheet. Anyone with the link will need this password to view it.</p>
            <div class="modal-form">
                <input type="password" id="password-input" placeholder="Enter password" autocomplete="new-password">
                <input type="password" id="password-confirm" placeholder="Confirm password" autocomplete="new-password">
            </div>
            <p id="modal-error" class="modal-error hidden"></p>
            <div class="modal-buttons">
                <button id="modal-cancel" type="button" class="modal-btn modal-btn-secondary">Cancel</button>
                <button id="modal-submit" type="button" class="modal-btn modal-btn-primary">Set Password</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js" integrity="sha512-qtX0GLM3qX8rxJN1gyDfcnMFFrKvixfoEOwbBib9VafR5vbChV5LeE5wSI/x+IlCkTY5ZFddFDCCfaVJJNnuKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="script.js"></script>
</body>

</html>
